<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jamie's Chess</title>
</head>
<body>
체스 방을 선택하세요.
<!-- 방 보여주기 -->
<form method="post" action="/start">
    <select id="rooms" name="roomId">
    </select>
    <input type="submit" value="입장"/>
    <input type="button" id="delete-room" value="삭제"/>
</form>
<br>
<!-- 새로운 방 생성 -->
<input type="text" id="room-name" maxlength="10" minlength="1"/>
<button id="create-room">방만들기</button>
<!-- 방 선택하는 input Box -->
<script type="text/javascript">
    const rooms = document.getElementById("rooms");
    const createRoomName = document.getElementById("room-name");
    const creatRoom = document.getElementById("create-room");
    const deleteRoom = document.getElementById("delete-room");

    let roomName = null;
    let roomPassword = null;
    let roomsChild = null;
    let index = null;
    let roomId = null;

    fetch('/viewRooms').then(res => res.json()).then(data => {
        for (key in data.rooms) {
            let opt = document.createElement("option");
            opt.value = key;
            opt.textContent = data.rooms[key];
            rooms.appendChild(opt);
        }
    });

    deleteRoom.onclick = () => {
        roomId = rooms.value;
        roomsChild = rooms.children;
        for (index = 0; index < rooms.childElementCount;) {
            rooms.removeChild(roomsChild.item(index));
        }
        fetch("/deleteRoom", {
            method: 'Post',
            body: JSON.stringify({
                roomId
            })
        }).then(res => res.json()).then(data => {
            for (key in data.rooms) {
                let opt = document.createElement("option");
                opt.value = key;
                opt.textContent = data.rooms[key];
                rooms.appendChild(opt);
                createRoomName.value = "";
            }
        })
    };

    creatRoom.onclick = () => {
        roomsChild = rooms.children;
        for (index = 0; index < rooms.childElementCount;) {
            rooms.removeChild(roomsChild.item(index));
        }
        roomName = createRoomName.value;
        roomPassword = '';
        fetch('/createRoom', {
            method: 'POST',
            body: JSON.stringify({
                roomName, roomPassword
            })
        }).then(res => res.json()).then(data => {
            for (key in data.rooms) {
                let opt = document.createElement("option");
                opt.value = key;
                opt.textContent = data.rooms[key];
                rooms.appendChild(opt);
                createRoomName.value = "";
            }
        })
    };

</script>
</body>
</html>